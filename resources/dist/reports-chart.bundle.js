(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[51],{162:function(t,e,i){var a={"./fa":126,"./fa.js":126};function r(t){var e=s(t);return i(e)}function s(t){if(!i.o(a,t)){var e=new Error("Cannot find module '"+t+"'");e.code="MODULE_NOT_FOUND";throw e}return a[t]}r.keys=function t(){return Object.keys(a)};r.resolve=s;t.exports=r;r.id=162},401:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this;var e=t.$createElement;var i=t._self._c||e;return i("v-col",{class:"vf-input "+(this.field.class?this.field.class:""),attrs:{cols:"12",md:t.field.md?t.field.md:6,lg:t.field.lg?t.field.lg:6,sm:t.field.sm?t.field.sm:6,xs:t.field.xs?t.field.xs:6}},[i("v-card",{staticStyle:{border:"solid 1px lightgray"}},[i("v-card-actions",{staticClass:"text-subtitle-1 pt-0",attrs:{dark:""}},[i("v-list",{staticClass:"px-0 mx-auto",attrs:{dense:""}},[i("v-list-item",{staticClass:"px-0"},[i("v-list-item-content",[i("v-list-item-title",[t._v(t._s(t.field.label))]),t._v(" "),t.field.subtitle?i("v-list-item-subtitle",[t._v("\n                "+t._s(t.field.subtitle)+"\n                "),i("v-chip",{attrs:{dense:"",small:""}},[t._v("\n                    "+t._s(this.duration)+"\n                ")]),t._v(" "),t.field.is_windowed?i("v-chip",{attrs:{dense:"",small:""}},[t._v("\n                    "+t._s(this.window)+"\n                ")]):t._e()],1):t._e()],1),t._v(" "),i("v-list-item-action",{staticClass:"my-auto d-flex flex-row"},[i("v-btn",{attrs:{loading:t.loading,icon:"",small:""},on:{click:function(e){return t.updateReport()}}},[i("v-icon",{attrs:{small:""}},[t._v("\n                    mdi-refresh\n                ")])],1),t._v(" "),i("v-btn",{attrs:{icon:"",small:"",color:t.autoupdate?"success":"secondary"},on:{click:function(e){t.autoupdate=!t.autoupdate}}},[i("v-icon",{attrs:{small:""}},[t._v("\n                    mdi-refresh-circle\n                ")])],1),t._v(" "),i("v-btn",{attrs:{icon:"",small:""},on:{click:function(e){t.show=!t.show}}},[i("v-icon",{attrs:{small:""}},[t._v("\n                    "+t._s(t.show?"mdi-chevron-up":"mdi-chevron-down")+"\n                ")])],1)],1)],1)],1),t._v(" "),i("div",{staticClass:"d-flex flex-column"})],1),t._v(" "),i("v-expand-transition",[i("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}]},[i("v-divider"),t._v(" "),i("v-card-text",{staticClass:"d-flex flex-column"},[i("v-select",{staticClass:"mx-4 my-1",attrs:{items:t.durations,label:"بازه زمانی گزارش",flat:"",outlined:"",rounded:"","hide-details":"",dense:"","item-text":"id","item-value":"id"},model:{value:t.duration,callback:function(e){t.duration=e},expression:"duration"}}),t._v(" "),t.field.is_windowed?i("v-select",{staticClass:"mx-4 my-1",attrs:{items:t.windows,label:"پنجره تجمیع",flat:"",outlined:"",rounded:"","hide-details":"",dense:"","item-text":"id","item-value":"id"},model:{value:t.window,callback:function(e){t.window=e},expression:"window"}}):t._e(),t._v(" "),t.field.filters?i("vf-fields-renderer",{attrs:{fields:t.field.filters,options:{type:"col"}},model:{value:t.extraFilters,callback:function(e){t.extraFilters=e},expression:"extraFilters"}}):t._e()],1)],1)]),t._v(" "),i("v-card-text",{staticClass:"pb-0"},[i("canvas",{ref:"chart",staticStyle:{height:"80%"}})])],1)],1)};var r=[];var s=i(124);var n=i(985);var d=i.n(n);var l=i(163);var o=i.n(l);var u=i(165);function f(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);if(e)a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}));i.push.apply(i,a)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};if(e%2){f(Object(i),true).forEach((function(e){h(t,e,i[e])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))}else{f(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}}return t}function h(t,e,i){if(e in t){Object.defineProperty(t,e,{value:i,enumerable:true,configurable:true,writable:true})}else{t[e]=i}return t}var v={name:"VfReportChartInput",components:{},mixins:[s["d"],s["a"]],props:{id:String,field:Object,value:[Object,String,Array,Number]},data:function t(e){return{data:e.field.data,duration:e.field.default_duration?e.field.default_duration:"1h",window:e.field.default_window?e.field.default_window:"1m",show:false,loading:false,autoupdate:false,durations:[{id:"1m"},{id:"5m"},{id:"10m"},{id:"30m"},{id:"1h"},{id:"3h"},{id:"6h"},{id:"12h"},{id:"1d"},{id:"2d"},{id:"7d"},{id:"15d"},{id:"30d"},{id:"90d"},{id:"180d"},{id:"1y"},{id:"2y"}],windows:[{id:"1s"},{id:"10s"},{id:"30s"},{id:"1m"},{id:"5m"},{id:"10m"},{id:"15m"},{id:"30m"},{id:"1h"},{id:"3h"},{id:"6h"},{id:"12h"},{id:"1d"},{id:"7d"},{id:"30d"}],chart:null,extraFilters:{}}},computed:{datasets:function t(){var e=this;if(!this.data){return[]}var i=function t(){return"#"+Math.floor(Math.random()*16777215).toString(16)};if(this.field.report_groups&&this.field.report_groups.length>0){var a=this.field.report_groups.split(",");var r=[];a.forEach((function(t){var a={};e.data.map((function(e){a[e[t]]?a[e[t]]+=1:a[e[t]]=1}));var s=0;var n=function a(n){var d="";if(e.field.labels){var l=e.field.labels.filter((function(t){return t[e.field.report_label_key]==n}));if(l&&l[0]){var u=c({key:n},l[0]);d=e.getDecorableLabel(u)}}r.push({label:d,backgroundColor:i(),borderColor:i(),data:e.data.filter((function(e){return e[t]==n})).map((function(t){return{y:t._value?t._value:0,x:o()(t._time)}}))});s++};for(var d in a){n(d)}}));return r}else{var s=function t(e,i){return"#"+e.replace(/^#/,"").replace(/../g,(function(t){return("0"+Math.min(255,Math.max(0,parseInt(t,16)+i)).toString(16)).substr(-2)}))};var n=[];var d=[];this.data.forEach((function(t){var e=i();n.push(s(e,20));d.push(e)}));return[{data:this.data.map((function(t){return t._value})),backgroundColor:n,borderColor:d,borderWidth:1}]}},labels:function t(){var e=this;if(this.field.is_x_time){return this.data.map((function(t){return t._time}))}return this.data.map((function(t){if(e.field.labels){var i=e.field.labels.filter((function(i){return i[e.field.report_label_key]==t[e.field.report_item_key]}));if(i&&i[0]){var a=c(c({},t),i[0]);return e.getDecorableLabel(a)}}return t[e.field.report_item_key]}))}},watch:{data:function t(){if(this.data){if(this.chart){this.chart.destroy()}this.chart=new d.a(this.$refs.chart,{type:this.field.report_type,data:{labels:this.labels,datasets:this.datasets},options:{scales:this.field.report_type==="bar"||this.field.report_type==="line"?{xAxes:[{type:"time",time:{unit:this.window.endsWith("d")?"day":this.window.endsWith("h")?"hour":this.window.endsWith("s")?"second":"minute",tooltipFormat:"jYYYY/jMM/jDD, h:mm:ss a",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"jMM/jDD",week:"ll",month:"jYYYY/jMM",quarter:"[Q]Q - jYYYY",year:"jYYYY"}}}]}:{},legend:{display:true,position:"bottom"}}})}}},mounted:function t(){d.a._adapters._date.override({format:function t(e,i){return o()(e).locale("fa").format(i)}});this.updateReport()},methods:{updateReport:function t(){var e=this;this.loading=true;var i=this.$store.state.host;var a=o()();var r=o()();var s=parseInt(this.duration.substr(0,this.duration.length-1));if(this.duration.endsWith("m")){a.add(-1*s,"minute")}else if(this.duration.endsWith("h")){a.add(-1*s,"hour")}else if(this.duration.endsWith("d")){a.add(-1*s,"day")}else if(this.duration.endsWith("s")){a.add(-1*s,"secoonds")}else if(this.duration.endsWith("y")){a.add(-1*s,"year")}var n=this.field.filters?this.extraFilters:{};if(this.field.query_filters){this.field.query_filters.forEach((function(t){n[t.filter]=t.value}))}if(this.field.report_url){var d;i.axios({url:this.field.report_url,method:"POST",headers:i.getWebAuthHeaders({}),data:{name:this.field.report_name,from:a.format("Y-MM-DDTH:mm:ssZ"),to:r.format("Y-MM-DDTH:mm:ssZ"),window:this.window,group:(d=this.field.group)===null||d===void 0?void 0:d.split(","),filters:n,func:this.field.func}}).then((function(t){e.loading=false;e.data=t.data}))["catch"]((function(t){e.loading=false;i.showSnack(t.message)}))}}}};var m=v;var p=i(27);var b=i(28);var _=i.n(b);var w=i(69);var y=i(113);var x=i(53);var g=i(87);var j=i(411);var O=i(114);var k=i(16);var C=i(61);var Y=i(115);var D=i(71);var V=i(116);var M=i(11);var S=i(21);var P=Object(p["a"])(m,a,r,false,null,null,null);var W=e["default"]=P.exports;_()(P,{VBtn:w["a"],VCard:y["a"],VCardActions:x["a"],VCardText:x["b"],VChip:g["a"],VCol:j["a"],VDivider:O["a"],VExpandTransition:k["a"],VIcon:C["a"],VList:Y["a"],VListItem:D["a"],VListItemAction:V["a"],VListItemContent:M["a"],VListItemSubtitle:M["b"],VListItemTitle:M["c"],VSelect:S["a"]})}}]);