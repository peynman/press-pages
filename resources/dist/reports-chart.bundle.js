(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{UFej:function(t,e,i){var a={"./fa":"jfSC","./fa.js":"jfSC"};function r(t){var e=s(t);return i(e)}function s(t){if(!i.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}r.keys=function(){return Object.keys(a)},r.resolve=s,t.exports=r,r.id="UFej"},kiai:function(t,e,i){"use strict";i.r(e);var a=i("I1Ao"),r=i("MO+k"),s=i.n(r),n=i("pnuC"),d=i.n(n);i("f0Wu");function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){u(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var c={name:"VfReportChartInput",components:{},mixins:[a.d,a.a],props:{id:String,field:Object,value:[Object,String,Array,Number]},data:function(t){return{data:t.field.data,duration:t.field.default_duration?t.field.default_duration:"1h",window:t.field.default_window?t.field.default_window:"1m",show:!1,loading:!1,autoupdate:!1,durations:[{id:"1m"},{id:"5m"},{id:"10m"},{id:"30m"},{id:"1h"},{id:"3h"},{id:"6h"},{id:"12h"},{id:"1d"},{id:"2d"},{id:"7d"},{id:"15d"},{id:"30d"},{id:"90d"},{id:"180d"},{id:"1y"},{id:"2y"}],windows:[{id:"1s"},{id:"10s"},{id:"30s"},{id:"1m"},{id:"5m"},{id:"10m"},{id:"15m"},{id:"30m"},{id:"1h"},{id:"3h"},{id:"6h"},{id:"12h"},{id:"1d"},{id:"7d"},{id:"30d"}],chart:null,extraFilters:{}}},computed:{datasets:function(){var t=this;if(!this.data)return[];var e=function(){return"#"+Math.floor(16777215*Math.random()).toString(16)};if(this.field.report_groups&&this.field.report_groups.length>0){var i=this.field.report_groups.split(","),a=[];return i.forEach((function(i){var r={};t.data.map((function(t){r[t[i]]?r[t[i]]+=1:r[t[i]]=1}));var s=function(r){var s="";if(t.field.labels){var n=t.field.labels.filter((function(e){return e[t.field.report_label_key]==r}));if(n&&n[0]){var o=l({key:r},n[0]);s=t.getDecorableLabel(o)}}a.push({label:s,backgroundColor:e(),borderColor:e(),data:t.data.filter((function(t){return t[i]==r})).map((function(t){return{y:t._value?t._value:0,x:d()(t._time)}}))})};for(var n in r)s(n)})),a}var r=[],s=[];return this.data.forEach((function(t){var i=e();r.push(function(t,e){return"#"+t.replace(/^#/,"").replace(/../g,(function(t){return("0"+Math.min(255,Math.max(0,parseInt(t,16)+e)).toString(16)).substr(-2)}))}(i,20)),s.push(i)})),[{data:this.data.map((function(t){return t._value})),backgroundColor:r,borderColor:s,borderWidth:1}]},labels:function(){var t=this;return this.field.is_x_time?this.data.map((function(t){return t._time})):this.data.map((function(e){if(t.field.labels){var i=t.field.labels.filter((function(i){return i[t.field.report_label_key]==e[t.field.report_item_key]}));if(i&&i[0]){var a=l(l({},e),i[0]);return t.getDecorableLabel(a)}}return e[t.field.report_item_key]}))}},watch:{data:function(){this.data&&(this.chart&&this.chart.destroy(),this.chart=new s.a(this.$refs.chart,{type:this.field.report_type,data:{labels:this.labels,datasets:this.datasets},options:{scales:"bar"===this.field.report_type||"line"===this.field.report_type?{xAxes:[{type:"time",time:{unit:this.window.endsWith("d")?"day":this.window.endsWith("h")?"hour":this.window.endsWith("s")?"second":"minute",tooltipFormat:"jYYYY/jMM/jDD, h:mm:ss a",displayFormats:{millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"jMM/jDD",week:"ll",month:"jYYYY/jMM",quarter:"[Q]Q - jYYYY",year:"jYYYY"}}}]}:{},legend:{display:!0,position:"bottom"}}}))}},mounted:function(){s.a._adapters._date.override({format:function(t,e){return d()(t).locale("fa").format(e)}}),this.updateReport()},methods:{updateReport:function(){var t=this;this.loading=!0;var e=this.$store.state.host,i=d()(),a=d()(),r=parseInt(this.duration.substr(0,this.duration.length-1));this.duration.endsWith("m")?i.add(-1*r,"minute"):this.duration.endsWith("h")?i.add(-1*r,"hour"):this.duration.endsWith("d")?i.add(-1*r,"day"):this.duration.endsWith("s")?i.add(-1*r,"secoonds"):this.duration.endsWith("y")&&i.add(-1*r,"year");var s,n=this.field.filters?this.extraFilters:{};(this.field.query_filters&&this.field.query_filters.forEach((function(t){n[t.filter]=t.value})),this.field.report_url)&&e.axios({url:this.field.report_url,method:"POST",headers:e.getWebAuthHeaders({}),data:{name:this.field.report_name,from:i.format("Y-MM-DDTH:mm:ssZ"),to:a.format("Y-MM-DDTH:mm:ssZ"),window:this.window,group:null===(s=this.field.group)||void 0===s?void 0:s.split(","),filters:n,func:this.field.func}}).then((function(e){t.loading=!1,t.data=e.data})).catch((function(i){t.loading=!1,e.showSnack(i.message)}))}}},f=i("KHd+"),h=i("ZUTo"),m=i.n(h),p=i("gzZi"),v=i("sK+t"),b=i("mdmw"),_=i("zCDB"),w=i("Yq0q"),y=i("zn5u"),x=i("B4nN"),g=i("Ey0z"),j=i("iGBT"),O=i("2hOt"),C=i("GADD"),k=i("XSMC"),D=i("uXRr"),Y=Object(f.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-col",{class:"vf-input "+(this.field.class?this.field.class:""),attrs:{cols:"12",md:t.field.md?t.field.md:6,lg:t.field.lg?t.field.lg:6,sm:t.field.sm?t.field.sm:6,xs:t.field.xs?t.field.xs:6}},[i("v-card",{staticStyle:{border:"solid 1px lightgray"}},[i("v-card-actions",{staticClass:"text-subtitle-1 pt-0",attrs:{dark:""}},[i("v-list",{staticClass:"px-0 mx-auto",attrs:{dense:""}},[i("v-list-item",{staticClass:"px-0"},[i("v-list-item-content",[i("v-list-item-title",[t._v(t._s(t.field.label))]),t._v(" "),t.field.subtitle?i("v-list-item-subtitle",[t._v("\n                "+t._s(t.field.subtitle)+"\n                "),i("v-chip",{attrs:{dense:"",small:""}},[t._v("\n                    "+t._s(this.duration)+"\n                ")]),t._v(" "),t.field.is_windowed?i("v-chip",{attrs:{dense:"",small:""}},[t._v("\n                    "+t._s(this.window)+"\n                ")]):t._e()],1):t._e()],1),t._v(" "),i("v-list-item-action",{staticClass:"my-auto d-flex flex-row"},[i("v-btn",{attrs:{loading:t.loading,icon:"",small:""},on:{click:function(e){return t.updateReport()}}},[i("v-icon",{attrs:{small:""}},[t._v("\n                    mdi-refresh\n                ")])],1),t._v(" "),i("v-btn",{attrs:{icon:"",small:"",color:t.autoupdate?"success":"secondary"},on:{click:function(e){t.autoupdate=!t.autoupdate}}},[i("v-icon",{attrs:{small:""}},[t._v("\n                    mdi-refresh-circle\n                ")])],1),t._v(" "),i("v-btn",{attrs:{icon:"",small:""},on:{click:function(e){t.show=!t.show}}},[i("v-icon",{attrs:{small:""}},[t._v("\n                    "+t._s(t.show?"mdi-chevron-up":"mdi-chevron-down")+"\n                ")])],1)],1)],1)],1),t._v(" "),i("div",{staticClass:"d-flex flex-column"})],1),t._v(" "),i("v-expand-transition",[i("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}]},[i("v-divider"),t._v(" "),i("v-card-text",{staticClass:"d-flex flex-column"},[i("v-select",{staticClass:"mx-4 my-1",attrs:{items:t.durations,label:"بازه زمانی گزارش",flat:"",outlined:"",rounded:"","hide-details":"",dense:"","item-text":"id","item-value":"id"},model:{value:t.duration,callback:function(e){t.duration=e},expression:"duration"}}),t._v(" "),t.field.is_windowed?i("v-select",{staticClass:"mx-4 my-1",attrs:{items:t.windows,label:"پنجره تجمیع",flat:"",outlined:"",rounded:"","hide-details":"",dense:"","item-text":"id","item-value":"id"},model:{value:t.window,callback:function(e){t.window=e},expression:"window"}}):t._e(),t._v(" "),t.field.filters?i("vf-fields-renderer",{attrs:{fields:t.field.filters,options:{type:"col"}},model:{value:t.extraFilters,callback:function(e){t.extraFilters=e},expression:"extraFilters"}}):t._e()],1)],1)]),t._v(" "),i("v-card-text",{staticClass:"pb-0"},[i("canvas",{ref:"chart",staticStyle:{height:"80%"}})])],1)],1)}),[],!1,null,null,null);e.default=Y.exports;m()(Y,{VBtn:p.a,VCard:v.a,VCardActions:b.a,VCardText:b.b,VChip:_.a,VCol:w.a,VDivider:y.a,VExpandTransition:x.a,VIcon:g.a,VList:j.a,VListItem:O.a,VListItemAction:C.a,VListItemContent:k.a,VListItemSubtitle:k.b,VListItemTitle:k.c,VSelect:D.a})}}]);
//# sourceMappingURL=reports-chart.bundle.js.map